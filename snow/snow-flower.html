<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="single-spinner.html">

<polymer-element name="snow-flower" attributes="">
	<template>
		<style>
			single-spinner{
				width: auto;
				height: auto;
			}
		</style>
		<single-spinner id="flower" startColor="#fff" middleColor="#1074C5" endColor="#fff" brickW='3px' brickH='15px' gelW="15px" gelH="15px"></single-spinner>
	</template>

	<script>
		Polymer('snow-flower',{
			//为什么在这里生成的是一样的 --
			//为什么会变卡
			//定义颜色
			//窗口高宽
			winW: window.innerWidth||document.body.clientWidth,
			winH: window.innerHeight||document.body.clientHeight, 
			// 缩放比例
			scale: Math.random()+0.5,
			// 初始位置
			left: 0,
			top: 0,
			// 下落速度 todo
			speedX: 0.2,
			speedY: 0.5,
			// 定时器
			fallingTimer: null,
			deadTimer: null,
			ready: function(){
				var self = this;

				self.born(); 
				self.falling();
				self.dead();
			},
          	/**
          	 * 生成雪花
          	 * @return {[type]} [description]
          	 */
          	born: function(){
          		var self = this;

          		self.left = Math.random()*(self.winW+1);
				self.scale = Math.random()+0.5;

				this.$.flower.style.left = self.left + "px";
	            this.$.flower.style.top = "0 px";
	            //随机缩放
	            this.$.flower.style.transform = 'scale('+self.scale+')';
          	},
          	/**
          	 * 下落
          	 * @return {[type]} [description]
          	 */
          	falling: function(){
          		var self = this;

          		self.fallingTimer = setInterval(function(){
          			self.top += self.speedY;
          			self.left += self.speedX;
          			self.$.flower.style.top = self.top + "px";
          			self.$.flower.style.left = self.left + "px";
          		},8);
          	},
          	/**
          	 * 死亡
          	 * @return {[type]} [description]
          	 */	
          	dead: function(){
          		var self = this;

          		self.deadTimer = setInterval(function(){
          			//落地、左右出境
          			if(self.top >= self.winH-200
          			|| self.$.flower.offsetLeft>self.winW
          			|| self.$.flower.offsetLeft < 0
          			){
	          			// 移走
	          			self.parentNode.removeChild(self);
	          			clearInterval(self.fallingTimer);
	          			clearInterval(self.deadTimer); 
	          		}
          		},100);
          	}
		});
	</script>

</polymer-element>